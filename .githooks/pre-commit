#!/usr/bin/env sh

set -eu

if ! command -v gofmt >/dev/null 2>&1; then
  echo "pre-commit: gofmt is required but not found in PATH" >&2
  exit 1
fi

echo "pre-commit: running gofmt -w ."
gofmt -w .

echo "pre-commit: staging gofmt updates"
git add -A

LINT_CMD=""
if command -v golangci-lint >/dev/null 2>&1; then
  LINT_CMD="golangci-lint"
elif [ -x "$HOME/go/bin/golangci-lint" ]; then
  LINT_CMD="$HOME/go/bin/golangci-lint"
else
  echo "pre-commit: golangci-lint is required but not found in PATH or \$HOME/go/bin" >&2
  echo "pre-commit: install from https://golangci-lint.run/welcome/install/" >&2
  exit 1
fi

echo "pre-commit: running ${LINT_CMD} run"
"$LINT_CMD" run

echo "pre-commit: checks passed"
